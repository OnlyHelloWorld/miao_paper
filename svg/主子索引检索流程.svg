<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="900.9023px" preserveAspectRatio="none" style="width:832px;height:900px;background:#FFFFFF;" version="1.1" viewBox="0 0 832 900" width="832.961px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="35.7329" id="_title" style="stroke:none;stroke-width:1.3588270680239212;" width="165.7769" x="335.6303" y="13.5883"/><text fill="#000000" font-family="sans-serif" font-size="19.0236" font-weight="bold" lengthAdjust="spacing" textLength="152.1886" x="342.4244" y="38.0405">主子索引检索流程</text><rect fill="none" height="318.2309" style="stroke:#000000;stroke-width:2.0382406020358816;" width="751.4314" x="13.5883" y="126.2648"/><rect fill="none" height="363.6136" style="stroke:#000000;stroke-width:2.0382406020358816;" width="631.8546" x="192.9534" y="463.5193"/><line style="stroke:#181818;stroke-width:0.6794135340119606;stroke-dasharray:5.0,5.0;" x1="69.3002" x2="69.3002" y1="103.1647" y2="850.233"/><line style="stroke:#181818;stroke-width:0.6794135340119606;stroke-dasharray:5.0,5.0;" x1="248.6654" x2="248.6654" y1="103.1647" y2="850.233"/><line style="stroke:#181818;stroke-width:0.6794135340119606;stroke-dasharray:5.0,5.0;" x1="400.854" x2="400.854" y1="103.1647" y2="850.233"/><line style="stroke:#181818;stroke-width:0.6794135340119606;stroke-dasharray:5.0,5.0;" x1="580.2192" x2="580.2192" y1="103.1647" y2="850.233"/><line style="stroke:#181818;stroke-width:0.6794135340119606;stroke-dasharray:5.0,5.0;" x1="758.2255" x2="758.2255" y1="103.1647" y2="850.233"/><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="84.2473" x="27.1765" y="57.4741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="65.2237" x="36.6883" y="87.1666">传感器</text><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="84.2473" x="27.1765" y="848.8741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="65.2237" x="36.6883" y="878.5666">传感器</text><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="84.2473" x="206.5417" y="57.4741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="65.2237" x="216.0535" y="87.1666">区块链</text><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="84.2473" x="206.5417" y="848.8741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="65.2237" x="216.0535" y="878.5666">区块链</text><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="84.2473" x="358.7303" y="57.4741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="65.2237" x="368.2421" y="87.1666">主索引</text><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="84.2473" x="358.7303" y="848.8741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="65.2237" x="368.2421" y="878.5666">主索引</text><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="84.2473" x="538.0955" y="57.4741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="65.2237" x="547.6073" y="87.1666">子索引</text><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="84.2473" x="538.0955" y="848.8741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="65.2237" x="547.6073" y="878.5666">子索引</text><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="105.9885" x="705.2312" y="57.4741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="86.9649" x="714.743" y="87.1666">查询请求</text><rect fill="#E2E2F0" height="44.3317" rx="3.3971" ry="3.3971" style="stroke:#181818;stroke-width:0.6794135340119606;" width="105.9885" x="705.2312" y="848.8741"/><text fill="#000000" font-family="sans-serif" font-size="21.7412" lengthAdjust="spacing" textLength="86.9649" x="714.743" y="878.5666">查询请求</text><path d="M13.5883,126.2648 L145.3945,126.2648 L145.3945,135.957 L131.8062,149.5453 L13.5883,149.5453 L13.5883,126.2648 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0382406020358816;"/><rect fill="none" height="318.2309" style="stroke:#000000;stroke-width:2.0382406020358816;" width="751.4314" x="13.5883" y="126.2648"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" font-weight="bold" lengthAdjust="spacing" textLength="70.659" x="33.9707" y="144.0204">索引构建</text><polygon fill="#181818" points="232.3594,193.3887,245.9477,198.824,232.3594,204.2593,237.7947,198.824" style="stroke:#181818;stroke-width:1.3588270680239212;"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="69.3002" x2="240.5124" y1="198.824" y2="198.824"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="86.9649" x="78.812" y="171.3774">1.提交数据</text><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="146.7533" x="78.812" y="191.9403">(设备n1,时间窗口)</text><polygon fill="#181818" points="384.5481,253.538,398.1363,258.9733,384.5481,264.4086,389.9834,258.9733" style="stroke:#181818;stroke-width:1.3588270680239212;"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="248.6654" x2="392.701" y1="258.9733" y2="258.9733"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="104.6297" x="258.1771" y="231.5267">2.更新主索引</text><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="119.5768" x="258.1771" y="252.0896">(聚合时间窗口)</text><polygon fill="#181818" points="563.9132,313.6874,577.5015,319.1227,563.9132,324.558,569.3485,319.1227" style="stroke:#181818;stroke-width:1.3588270680239212;"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="248.6654" x2="572.0662" y1="319.1227" y2="319.1227"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="104.6297" x="258.1771" y="291.6761">3.生成子索引</text><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="169.8534" x="258.1771" y="312.239">(时间分片→区块位置)</text><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="400.854" x2="457.9247" y1="358.7091" y2="358.7091"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="457.9247" x2="457.9247" y1="358.7091" y2="376.3739"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="402.2128" x2="457.9247" y1="376.3739" y2="376.3739"/><polygon fill="#181818" points="415.8011,370.9386,402.2128,376.3739,415.8011,381.8092,410.3658,376.3739" style="stroke:#181818;stroke-width:1.3588270680239212;"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="160.3416" x="410.3658" y="351.8254">关联Verkle验证路径</text><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="580.2192" x2="637.2899" y1="415.9603" y2="415.9603"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="637.2899" x2="637.2899" y1="415.9603" y2="433.6251"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="581.578" x2="637.2899" y1="433.6251" y2="433.6251"/><polygon fill="#181818" points="595.1663,428.1898,581.578,433.6251,595.1663,439.0604,589.7309,433.6251" style="stroke:#181818;stroke-width:1.3588270680239212;"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="158.9828" x="589.7309" y="409.0766">存储KZG证明+指针</text><path d="M192.9534,463.5193 L324.7597,463.5193 L324.7597,473.2115 L311.1714,486.7998 L192.9534,486.7998 L192.9534,463.5193 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0382406020358816;"/><rect fill="none" height="363.6136" style="stroke:#000000;stroke-width:2.0382406020358816;" width="631.8546" x="192.9534" y="463.5193"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" font-weight="bold" lengthAdjust="spacing" textLength="70.659" x="213.3358" y="481.2749">数据查询</text><polygon fill="#181818" points="415.8011,530.6432,402.2128,536.0785,415.8011,541.5138,410.3658,536.0785" style="stroke:#181818;stroke-width:1.3588270680239212;"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="407.6481" x2="756.8667" y1="536.0785" y2="536.0785"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="108.7062" x="423.954" y="508.6319">4.查询设备n1</text><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="70.659" x="423.954" y="529.1948">时间范围</text><polygon fill="#181818" points="741.9196,570.2297,755.5078,575.665,741.9196,581.1003,747.3549,575.665" style="stroke:#181818;stroke-width:1.3588270680239212;"/><line style="stroke:#181818;stroke-width:1.3588270680239212;stroke-dasharray:2.0,2.0;" x1="400.854" x2="750.0725" y1="575.665" y2="575.665"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="158.9828" x="410.3658" y="568.7813">返回关联时间段集合</text><polygon fill="#181818" points="595.1663,630.379,581.578,635.8143,595.1663,641.2496,589.7309,635.8143" style="stroke:#181818;stroke-width:1.3588270680239212;"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="587.0133" x2="756.8667" y1="635.8143" y2="635.8143"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="122.2944" x="603.3192" y="608.3677">5.按时间片查询</text><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="105.9885" x="603.3192" y="628.9306">具体数据位置</text><polygon fill="#181818" points="741.9196,690.5283,755.5078,695.9636,741.9196,701.3989,747.3549,695.9636" style="stroke:#181818;stroke-width:1.3588270680239212;"/><line style="stroke:#181818;stroke-width:1.3588270680239212;stroke-dasharray:2.0,2.0;" x1="580.2192" x2="750.0725" y1="695.9636" y2="695.9636"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="120.9356" x="589.7309" y="668.517">返回区块指针+</text><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="70.659" x="589.7309" y="689.0799">验证路径</text><polygon fill="#181818" points="263.6125,750.6776,250.0242,756.113,263.6125,761.5483,258.1771,756.113" style="stroke:#181818;stroke-width:1.3588270680239212;"/><line style="stroke:#181818;stroke-width:1.3588270680239212;" x1="255.4595" x2="756.8667" y1="756.113" y2="756.113"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="139.9592" x="271.7654" y="728.6664">6.获取数据并验证</text><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="52.9943" x="271.7654" y="749.2292">完整性</text><polygon fill="#181818" points="741.9196,810.827,755.5078,816.2623,741.9196,821.6976,747.3549,816.2623" style="stroke:#181818;stroke-width:1.3588270680239212;"/><line style="stroke:#181818;stroke-width:1.3588270680239212;stroke-dasharray:2.0,2.0;" x1="248.6654" x2="750.0725" y1="816.2623" y2="816.2623"/><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="105.9885" x="258.1771" y="788.8157">返回验证结果</text><text fill="#000000" font-family="sans-serif" font-size="17.6648" lengthAdjust="spacing" textLength="85.6061" x="258.1771" y="809.3786">和CO₂总量</text><!--MD5=[bb846ac0e7ec67f8bb76bb5829964989]
@startuml
skinparam participantFontSize 16
scale 900 width 
scale 900 height

title 主子索引检索流程

participant 传感器 as S
participant 区块链 as BC
participant 主索引 as MainIdx
participant 子索引 as SubIdx
participant 查询请求 as Audit

group 索引构建
S -> BC: 1.提交数据\n(设备n1,时间窗口)
BC -> MainIdx: 2.更新主索引\n(聚合时间窗口)
BC -> SubIdx: 3.生成子索引\n(时间分片→区块位置)
MainIdx -> MainIdx: 关联Verkle验证路径
SubIdx -> SubIdx: 存储KZG证明+指针
end

group 数据查询
Audit -> MainIdx: 4.查询设备n1\n时间范围
MainIdx - -> Audit: 返回关联时间段集合
Audit -> SubIdx: 5.按时间片查询\n具体数据位置
SubIdx - -> Audit: 返回区块指针+\n验证路径
Audit -> BC: 6.获取数据并验证\n完整性
BC - -> Audit: 返回验证结果\n和CO₂总量
end
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>